$(document).ready(function(){function N(a){a=parseInt(a,10);var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60);10>b&&(b="0"+b);10>c&&(c="0"+c);if("00"!==b)return b+" hours "+c+" mins";if("00"!==c)return c+" mins";if(30<a)return" 1 mins"}function H(a){I.geocode({latLng:a},function(b){b&&0<b.length?t(b[0].formatted_address):t("Tidak ada koordinat yang ditemukan!")})}function u(a){v=a.lat();w=a.lng()}function t(a){document.getElementById("orig").value=a}function J(a){I.geocode({latLng:a},function(b){b&&
0<b.length?x(b[0].formatted_address):x("Tidak ada koordinat yang ditemukan!")})}function y(a){z=a.lat();A=a.lng()}function x(a){document.getElementById("dest").value=a}var B=0,K=new function(a){this.getJson=function(b){$.ajax({type:"POST",data:{action:"getlistEvent"},url:a,async:!1,success:b,error:function(b,a,e){alert(a+e)}})};this.sendEvent=function(b){$.ajax({type:"POST",url:a,data:{action:"addEvent",json:JSON.stringify(b)},async:!1,success:function(b){confirm(b)},error:function(b,a,e){confirm(a+
e)}})};this.deleteEvent=function(b,c,d,e){$.ajax({type:"POST",url:a,data:{action:"deleteEvent",event_id:b},async:!1,success:function(a){"OK"===a.status&&(c.remove(),$("#calendar").fullCalendar("removeEvents",[b]),delete l[d]);confirm(a.message)},error:function(b,a,c){confirm(a+c)}})}}("index"),l=[],C=new function(a){this.appendRow=function(b){$(a+" > tbody").append(b)};this.writeRow=function(b){b='<tr><td style="display:none">'+b.id+"</td><td>"+b.title+"</td><td>"+moment(b.start).format("ddd DD-MM-YYYY hh:mm a")+
"</td><td>"+b.transportation+"</td><td>"+moment(b.departure_time).format("ddd DD-MM-YYYY hh:mm a")+"</td><td>"+b.address+'</td><td><button class="v-more"> View More </button> <button class="v-del"> Delete </button></td></tr>';$(a+" > tbody").append(b)};this.actionListener=function(b,c,d){$(a).on(b,c,function(){var b=$(this).closest("tr"),a=$(this).parent().index();d(b,a)})};this.getCssId=function(){return a}}("#tableEvent"),q=new function(a){this.writeCal=function(b,c){$(a).fullCalendar({header:{left:"prev,next today",
center:"title",right:"month,agendaWeek,agendaDay,listWeek"},navLinks:!1,editable:!1,eventLimit:!0,events:b,eventClick:c})};this.gotoDate=function(b){$(a).fullCalendar("gotoDate",b)};this.deleteEvent=function(b){$(a).fullCalendar("removeEvents",[b])};this.getEvent=function(b){return $(a).fullCalendar("clientEvents",b)};this.changeCalView=function(b){$(a).fullCalendar("changeView",b)}}("#calendar"),k=new function(a){this.openTab=function(b,a){$(".tabcontent").hide();$(".tablinks").removeClass(".active");
$(b).show();$(a).addClass(".active")};this.viewMore=function(b,a){var c=moment(b.start,"YYYY-MM-DD hh:mm").format();$("#moreTitle").val(b.title.toString());$("#moreStartDate").val(c.toString().substring(0,10));$("#moreStartTime").val(c.toString().substring(11,16));$("#moreMode").val(b.transportation);c=moment(b.depature_time,"YYYY-MM-DD hh:mm").format();$("#moreDepatureDate").val(c.toString().substring(0,10));$("#moreDepatureTime").val(c.toString().substring(11,16));$("#moreAddress").val(b.address);
$("#moreNote").val(b.note);B=b.id;this.openTab("#MoreEvent","#MoreEvent");$("#map").appendTo("#moreLeft");$("#mapInstruction").appendTo("#moreLeft");if("undefined"!==typeof b.latitude||"undefined"!==typeof b.longitude)a.cleanRoutes(),a.objMaps.removeMarkers(),a.objMaps.setCenter(b.latitude,b.longitude),a.objMaps.drawRoute({origin:[b.start_latitude,b.start_longitude],destination:[b.latitude,b.longitude],travelMode:b.transportation.toString(),strokeColor:"#131540",strokeOpacity:.7,trokeWeight:6}),"undefined"!==
this.markerView1&&a.objMaps.removeMarker(this.markerView1),"undefined"!==this.markerView2&&a.objMaps.removeMarker(this.markerView2),this.markerView1=a.objMaps.addMarker({lat:b.latitude,lng:b.longitude,title:"event location",icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}),this.markerView2=a.objMaps.addMarker({lat:b.start_latitude,lng:b.start_longitude,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png",title:"previous location"})}}({});k.openTab("#Tasik","#defaultOpen");$("#moreBack").click(function(){var a=
$("#calendar").fullCalendar("getView");k.openTab("#Tasik","#getList");$("#calendar").fullCalendar("changeView",a.name,{start:a.start,end:a.end})});var h=new GMaps({el:"#map",lat:-6.872034,lng:107.574794,zoom:14});var f=new function(a){this.objMaps=a;this.drawRoutes=function(b,a,d,e){this.objMaps.travelRoute({origin:b,destination:a,travelMode:d,step:e})};this.drawPolylines=function(b){this.objMaps.drawPolyline({path:b,strokeColor:"#131540",strokeOpacity:.6,strokeWeight:6})};this.setGeolocate=function(){var b=
this.objMaps;GMaps.geolocate({success:function(a){b.setCenter(a.coords.latitude,a.coords.longitude)},error:function(b){confirm("Geolocation failed: "+b.message)},not_supported:function(){confirm("Your browser is not supported Geolocation")}})};this.addMarker=function(b,a,d,e,m){this.objMaps.addMarker({lat:b,lng:a,title:d,info:e,click:m})};this.addListener=function(b,a){"undefined"!==typeof google&&google.maps.event.addListener(this.objMaps.map,b,a)};this.clearListeners=function(b){"undefined"!==typeof google&&
google.maps.event.clearListeners(this.objMaps.map,b)};this.distanceMatrix=function(b,a){"undefined"!==typeof google&&(new google.maps.DistanceMatrixService).getDistanceMatrix(b,a)};this.reverseGeocode=function(a){var b;GMaps.geocode({location:a,callback:function(a,c){b="OK"==c?a[0].formatted_address.toString():"Error! not found"}});return b};this.geocodeLatLng=function(a){var b;GMaps.geocode({address:a,callback:function(a,c){b="OK"==c?a[0].geometry.location:{}}});return b};this.drawRoutesAnimated=
function(a,c,d){this.drawRoutes(c,d,a,function(b){$("#mapInstruction").html("<h1>"+a+"</h1>");$("#mapInstruction").append("<li>"+b.instructions+"</li>");$("#mapInstruction li:eq("+b.step_number+")").delay(450*b.step_number).fadeIn(200,function(){f.objMaps.drawPolyline({path:b.path,strokeColor:"#131540",strokeOpacity:.6,strokeWeight:6})})})};this.cleanRoutes=function(){this.objMaps.removePolylines()}}(h);var L=!0,D;K.getJson(function(a){q.writeCal(a.listEvent,function(a,b,c){k.viewMore(a,f)});$("#jv-notif").append(a.notif);
$("#logoNotif").append(a.notifCount);D=a.notifCount;$("#usernameContent").append(a.user);delete a.notif;delete a.user;var b=a.listEvent[a.listEvent.length-1];f.objMaps.setCenter(b.latitude,b.longitude);L=!1;var c=a.listEvent.length;for(b=0;b<c;b++)C.writeRow(a.listEvent[b]);$("#tableEvent").on("click",".v-more",function(){var a=$(this).closest("tr"),b={};b.id=a.find("td:eq(0)").html();b=q.getEvent(b.id)[0];k.viewMore(b,f)});delete a.htmlTable;var d=0;$.map(a.listEvent,function(a,b){l.push([a.latitude,
a.longitude]);d++;f.objMaps.addMarker({lat:a.latitude,lng:a.longitude,title:a.title,infoWindow:{content:"<p>"+d+". "+a.title+"</p>"},label:d.toString()})});f.drawPolylines(l);f.objMaps.zoomIn(4)});f.drawPolylines(l);$("#getList").click(function(){f.cleanRoutes();f.drawPolylines(l);$("#map").appendTo("#mainBottom");$("#mapInstruction").appendTo("#mainBottom");k.openTab("#Paris","#getList")});f.drawPolylines(l);$("#findEvent").on("keyup",function(){var a=$(this).val();2<a.length?($("#findResult").html("<ul>"),
$("#tableEvent > tbody > tr").each(function(b){if(0<=b){$row=$(this);b=$row.find("td:eq(1)").text().toLowerCase();var c=$row.find("td:eq(0)").text(),d=b.indexOf(a.toString().toLowerCase());0!==d&&0>d||($("#findResult").append('<li id="findResultMore'+c+'"><button style="padding: 6px 37px; border: none;background:none;font: 14px Arial;font-weight:bold;color:#757575;">'+b+"</button></li>"),$("#findResultMore"+c).click(function(){var a=q.getEvent(c)[0];k.viewMore(a,f);$("#findResult").html("");$("#findEvent").val("")}))}}),
$("#findResult").append("</ul>")):$("#findResult").html("")});$("#defaultOpenNew").click(function(){f.cleanRoutes();f.setGeolocate();$("#map").appendTo("#mapNewEvent");$("#mapInstruction").appendTo("#mapNewEvent");k.openTab("#London","#defaultOpenNew")});$("#defaultOpen").click(function(){f.cleanRoutes();f.drawPolylines(l);$("#map").appendTo("#mapsBottom");k.openTab("#Tasik","#defaultOpen")});$(C.getCssId()).on("click",".v-del",function(a){var b=$(this).closest("tr"),c=$(this).parent().index(),d=
b.find("td:eq(1)").html();confirm("Delete "+d+" ?")&&(d=b.find("td:eq(0)").html(),a.preventDefault(),K.deleteEvent(d,b,c,q),$("#map").appendTo("#moreLeft"),$("#mapInstruction").appendTo("#moreLeft"))});var E,F,M,r=function(a,b,c,d,e){f.distanceMatrix({origins:[E],destinations:[F],travelMode:b.toString().toUpperCase(),avoidHighways:e,avoidTolls:e},function(e,l){if("OK"!==l)alert("Error Mendapatkan Data");else{for(var m=0,G=0;G<e.rows.length;G++)for(var k=e.rows[G].elements,g=0;g<k.length;g++)"OK"===
k[g].status&&(m+=k[g].duration.value);m>a||0===m?($(c).hide(),$(d).val(b+" can't be used")):0!==a&&($(c).show().click(function(){h.drawRoute({origin:[z,A],destination:[v,w],travelMode:b,strokeColor:"#131540",strokeOpacity:.7,trokeWeight:6});f.cleanRoutes()}),$(d).val(N(m)))}})};$(".submit").click(function(){var a=new Date($("#origDate").val()+" "+$("#origTime").val()),b=new Date($("#departureDate").val()+" "+$("#departureTime").val());a=(a.getTime()-b.getTime())/1E3;E=$("#orig").val().toString();
F=$("#dest").val().toString();M=$("#eventName").val().toString();""!==E&&""!==F&&""!==M?(r(a,"transit","#radio","#transit",!1),r(a,"walking","#radio1","#walking",!1),r(a,"driving","#radio2","#driving",!1),r(a,"bicycling","#radio3","#bicycling",!0),$("#mapInstruction").appendTo("#mapPopup"),$("#map").appendTo("#mapPopup"),$("#myModal").show()):confirm("Please Fill The Form!")});var p={};$("#TombolSave").click(function(){for(var a={},b={},c={},d={},e,m=document.getElementsByName("transportation"),g=
0,h=m.length;g<h;g++)m[g].checked&&(e=m[g].value.toString().toLowerCase());a.title=$("#eventName").val();a.start=new Date($("#origDate").val()+" "+$("#origTime").val());a.end=new Date($("#destDate").val()+" "+$("#destTime").val());a.note=$("#noteDesc").val();c.transportation=e;c.depature_time=new Date($("#departureDate").val()+" "+$("#departureTime").val());b.latitude=v;b.longitude=w;b.address=$("#orig").val().substring(0,59);d.latitude=z;d.longitude=A;d.address=$("#dest").val().substring(0,59);p.event=
a;p.travel=c;p.startLocation=d;p.endLocation=b;$.ajax({type:"POST",url:"index",data:{action:"addEvent",json:JSON.stringify(p)},async:!1,timeout:16E3,success:function(e){"OK"===e.status?(a.id=e.generatedKey,a.address=b.address,a.depature_time=c.departure_time,a.transportation=c.transportation,a.latitude=b.latitude,a.longitude=b.longitude,a.start_latitude=d.latitude,a.start_longitude=d.longitude,e=Math.abs((new Date).getDay()-a.start.getDay()),e=Math.ceil(e/864E5),C.writeRow(a),$("#calendar").fullCalendar("renderEvent",
a),$("#jv-notif").append(a.title+" : The Next "+e+" Days"),D++,$("#logoNotif").html(D),k.openTab("#Tasik","#defaultOpen"),l.push([b.latitude,b.longitude]),f.drawPolylines(l)):confirm(e.title+"\n"+e.message)},error:function(a,b,c){confirm(b+c)}});L&&location.reload(!0)});$("#signout").click(function(){$.ajax({type:"POST",url:"index",data:{action:"logout"},async:!1,success:function(a){location.reload(!0)},error:function(a,b,c){alert(b+c)}})});$("#MoreEdit").click(function(){var a={},b={};a.id=B;a.title=
$("#moreTitle").val();a.start=new Date($("#moreStartDate").val()+" "+$("#moreStartTime").val());a.note=$("#noteDesc").val();b.event_id=B;b.transportation=$("#moreMode").val();b.depature_time=new Date($("#moreDepatureDate").val()+" "+$("#moreDepatureTime").val());p.event=a;p.travel=b;""!==a.title&&""!==a.start&&""!==a.end&&""!==b.departure_time?$.ajax({type:"POST",url:"index",data:{action:"editEvent",json:JSON.stringify(p)},async:!1,success:function(a){confirm(a.title+"\n"+a.message)},error:function(a,
b,e){confirm(b+e)}}):confirm("Mohon klik tujuan anda!")});$(".close").click(function(){$("#map").appendTo("#mapNewEvent");$("#mapInstruction").appendTo("#mapNewEvent");$("#myModal").hide();$("#mapInstruction").html("")});var I=new google.maps.Geocoder,v=null,w=null,z=null,A=null,g,n;google.maps.event.addDomListener(window,"load",function(){var a=new google.maps.LatLng(-6.872034,107.574794);g=h.addMarker({lat:a.lat(),lng:a.lng(),title:"event location",draggable:!0,icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"});
a.lat();a.lng();n=h.addMarker({lat:a.lat(),lng:a.lng(),title:"previous location",draggable:!0,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"});a.lat();a.lng();var b=document.getElementById("orig"),c=new google.maps.places.Autocomplete(b),d=document.getElementById("dest"),e=new google.maps.places.Autocomplete(d);c.bindTo("bounds",h);e.bindTo("bounds",h);u(a);y(a);google.maps.event.addListener(g,"dragstart",function(){t("Dragging...")});google.maps.event.addListener(g,"drag",function(){u(g.getPosition())});
google.maps.event.addListener(g,"dragend",function(){H(g.getPosition())});google.maps.event.addListener(n,"dragstart",function(){x("Dragging...")});google.maps.event.addListener(n,"drag",function(){y(n.getPosition())});google.maps.event.addListener(n,"dragend",function(){J(n.getPosition())});google.maps.event.addListener(c,"place_changed",function(){b.className="";var a=c.getPlace();a.geometry?(a.geometry.viewport?h.fitBounds(a.geometry.viewport):(h.setCenter(a.geometry.location),h.setZoom(17)),g.setPosition(a.geometry.location),
u(g.getPosition()),H(g.getPosition())):b.className="notfound"});google.maps.event.addListener(e,"place_changed",function(){b.className="";var a=e.getPlace();a.geometry?(a.geometry.viewport?h.fitBounds(a.geometry.viewport):(h.setCenter(a.geometry.location),h.setZoom(17)),n.setPosition(a.geometry.location),y(n.getPosition()),J(n.getPosition())):b.className="notfound"})})});