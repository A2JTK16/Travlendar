<!doctype html>
<html>
  <head>
    <style>
      #map {
		  width: 700px;
		  height: 500px;
		  border: 1px solid #a0a0a0;
		}
    </style>
  </head>
  <body>
    <br>
    Basic example for using the Distance Matrix.<br><br>
    Origin: <input id="orig" type="text" style="width:35em"><br><br>
    Destination: <input id="dest" type="text" style="width:35em"><br><br>
    Distance: <input id="dist" type="text" style="width:35em">
    <div id="map">Maps Event</div>



    <!-- Google Maps JS API -->
    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <!-- GMaps Library -->
    <script src="gmaps.js"></script>
    <div class="row">
        <label for="loc_text"><span style="font-size: 13px;">Enter Transportation Mode:</span></label>
      </div>
      <div id="output">
      </div>
	<script>
		var m1 = null, m2 = null;
		var m1pos, m2pos;
		var corvo = false, attano = true;
		var mapObj = new GMaps({
			el: '#map',
			lat: -6.914744,
			lng: 107.609810,
			zoom: 16,
			click: function(e) {
				if (corvo) {
					mapObj.removeMarker((attano) ? m1 : m2);
					mapObj.removePolylines();
				}

				if (attano) {
					m1 = mapObj.addMarker({
						lat: e.latLng.lat(),
						lng: e.latLng.lng(),
						//icon: sourceIcon
					});
					m1pos = m1.getPosition();
				} 
				else {
					m2 = mapObj.addMarker({
						lat: e.latLng.lat(),
						lng: e.latLng.lng(),
						//icon: destinationIcon
					});
					m2pos = m2.getPosition();
				}


				// If two markers have been placed
				if (m1 !== null && m2 !== null) {
					corvo = true;
					mapObj.drawRoute({
						origin: [m1pos.lat(), m1pos.lng()],
						destination: [m2pos.lat(), m2pos.lng()],
						travelMode: 'driving',
						strokeColor: '#131540',
						strokeOpacity: 0.6,
						strokeWeight: 6
					});
					//$('#trace_route').prop('disabled', false);
				}
				attano = !attano;
			
			var origin = new google.maps.LatLng(m1pos.lat(),m1pos.lng()),
    		destination = new google.maps.LatLng(m2pos.lat(),m2pos.lng()),
    		service = new google.maps.DistanceMatrixService();

			service.getDistanceMatrix(
    		{
       			 origins: [origin],
       			 destinations: [destination],
        		travelMode: google.maps.TravelMode.DRIVING,
        		avoidHighways: false,
        		avoidTolls: false
    			}, 
    		callback
				);

			function callback(response, status) {
    		var orig = document.getElementById("orig"),
        	dest = document.getElementById("dest"),
        	dist = document.getElementById("dist");

    		if(status=="OK") {
      		orig.value = response.destinationAddresses[0];
     	   dest.value = response.originAddresses[0];
        	dist.value = response.rows[0].elements[0].distance.text;
    		} else {
        		alert("Error: " + status);
    		}
			}

			}
		});
	</script>


  </body>
</html>